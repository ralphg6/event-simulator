var SSCD=function(){var t=t||{};return t.VERSION=1.5,t.Math={},t.Math.to_radians=function(t){return t*Math.PI/180},t.Math.to_degrees=function(t){return 180*t/Math.PI},t.Math.distance=function(t,i){var _=i.x-t.x,e=i.y-t.y;return Math.sqrt(_*_+e*e)},t.Math.dist2=function(t,i){var _=i.x-t.x,e=i.y-t.y;return _*_+e*e},t.Math.angle=function(t,i){var _=i.y-t.y,e=i.x-t.x;return 180*Math.atan2(_,e)/Math.PI},t.Math.distance_to_line=function(i,_,e){var s=t.Math.dist2(_,e),o=((i.x-_.x)*(e.x-_.x)+(i.y-_.y)*(e.y-_.y))/s;return 0>o?t.Math.distance(i,_):o>1?t.Math.distance(i,e):t.Math.distance(i,{x:_.x+o*(e.x-_.x),y:_.y+o*(e.y-_.y)})},t.Math.line_intersects=function(t,i,_,e){var s,o,n,r;s=i.x-t.x,o=i.y-t.y,n=e.x-_.x,r=e.y-_.y;var l,a;return l=(-o*(t.x-_.x)+s*(t.y-_.y))/(-n*o+s*r),a=(n*(t.y-_.y)-r*(t.x-_.x))/(-n*o+s*r),l>=0&&1>=l&&a>=0&&1>=a?1:0},t.Math.is_on_line=function(i,_,e){return t.Math.distance_to_line(i,_,e)<=5},t.Math.angles_dis=function(i,_){i=t.Math.to_radians(i),_=t.Math.to_radians(_);var e=2*Math.PI,s=(_-i)%e,o=2*s%e-s;return o=t.Math.to_degrees(o),Math.abs(o)},t.Vector=function(t,i){this.x=t,this.y=i},t.Vector.prototype={get_name:function(){return"vector"},clone:function(){return new t.Vector(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y},flip:function(){return new t.Vector(this.y,this.x)},flip_self:function(){return this.y=[this.x,this.x=this.y][0],this},negative:function(){return this.multiply_scalar(-1)},negative_self:function(){return this.multiply_scalar_self(-1),this},distance_from:function(i){return t.Math.distance(this,i)},angle_from:function(i){return t.Math.angle(this,i)},move:function(t){return this.x+=t.x,this.y+=t.y,this},normalize_self:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return 0===t?this:(this.x/=t,this.y/=t,this)},normalize:function(){return this.clone().normalize_self()},add_self:function(t){return this.x+=t.x,this.y+=t.y,this},sub_self:function(t){return this.x-=t.x,this.y-=t.y,this},divide_self:function(t){return this.x/=t.x,this.y/=t.y,this},multiply_self:function(t){return this.x*=t.x,this.y*=t.y,this},add_scalar_self:function(t){return this.x+=t,this.y+=t,this},sub_scalar_self:function(t){return this.x-=t,this.y-=t,this},divide_scalar_self:function(t){return this.x/=t,this.y/=t,this},multiply_scalar_self:function(t){return this.x*=t,this.y*=t,this},add:function(t){return this.clone().add_self(t)},sub:function(t){return this.clone().sub_self(t)},multiply:function(t){return this.clone().multiply_self(t)},divide:function(t){return this.clone().divide_self(t)},add_scalar:function(t){return this.clone().add_scalar_self(t)},sub_scalar:function(t){return this.clone().sub_scalar_self(t)},multiply_scalar:function(t){return this.clone().multiply_scalar_self(t)},divide_scalar:function(t){return this.clone().divide_scalar_self(t)},clamp:function(t,i){return this.x<t&&(this.x=t),this.y<t&&(this.y=t),this.x>i&&(this.x=i),this.y>i&&(this.y=i),this},from_radian:function(t){return this.x=Math.cos(t),this.y=Math.sin(t),this},from_angle:function(i){return this.from_radian(t.Math.to_radians(i))},apply_self:function(t){return this.x=t(this.x),this.y=t(this.y),this},apply:function(t){return this.clone().apply_self(t)},debug:function(){console.debug(this.x+", "+this.y)}},t.Vector.ZERO=new t.Vector(0,0),t.Vector.ONE=new t.Vector(1,1),t.Vector.UP=new t.Vector(0,-1),t.Vector.DOWN=new t.Vector(0,1),t.Vector.LEFT=new t.Vector(-1,0),t.Vector.RIGHT=new t.Vector(1,0),t.Vector.UP_LEFT=new t.Vector(-1,-1),t.Vector.DOWN_LEFT=new t.Vector(-1,1),t.Vector.UP_RIGHT=new t.Vector(1,-1),t.Vector.DOWN_RIGHT=new t.Vector(1,1),t.extend=function(t,i){for(var _ in t)i[_]||(i[_]=t[_]);i.__inits=i.__inits||[],t.__init__&&i.__inits.push(t.__init__),i.init=function(){for(var t=0;t<this.__inits.length;++t)this.__curr_init_func=this.__inits[t],this.__curr_init_func();delete this.__curr_init_func}},t.NotImplementedError=function(t){this.name="NotImplementedError",this.message=t||""},t.NotImplementedError.prototype=Error.prototype,t.AABB=function(t,i){this.position=t.clone(),this.size=i.clone()},t.AABB.prototype={expand:function(t){var i=Math.min(this.position.x,t.position.x),_=Math.min(this.position.y,t.position.y),e=Math.max(this.position.x+this.size.x,t.position.x+t.size.x),s=Math.max(this.position.y+this.size.y,t.position.y+t.size.y);this.position.x=i,this.position.y=_,this.size.x=e-i,this.size.y=s-_},add_vector:function(t){var i=this.position.x-t.x;i>0&&(this.position.x-=i,this.size.x+=i);var _=this.position.y-t.y;_>0&&(this.position.y-=_,this.size.y+=_);var e=t.x-(this.position.x+this.size.x);e>0&&(this.size.x+=e);var s=t.y-(this.position.y+this.size.y);s>0&&(this.size.y+=s)},clone:function(){return new t.AABB(this.position,this.size)}},t.World=function(t){this.__init_world(t)},t.World.prototype={__init_world:function(t){t=t||{},t.grid_size=t.grid_size||512,t.grid_error=void 0!==t.grid_error?t.grid_error:2,this.__grid={},this.__params=t,this.__all_shapes={},this.__collision_tags={},this.__next_coll_tag=0},__create_collision_tag:function(i){if(this.__collision_tags[i])throw new t.IllegalActionError("Collision tag named '"+i+"' already exist!");this.__collision_tags[i]=1<<this.__next_coll_tag++},_ALL_TAGS_VAL:Number.MAX_SAFE_INTEGER||4294967295,cleanup:function(){for(var t=Object.keys(this.__grid),i=0;i<t.length;++i){for(var _=t[i],e=Object.keys(this.__grid[_]),s=0;s<e.length;++s){var o=e[s];0===this.__grid[_][o].length&&delete this.__grid[_][o]}0===Object.keys(this.__grid[_]).length&&delete this.__grid[_]}},__get_tags_value:function(t){if(void 0===t)return this._ALL_TAGS_VAL;if("string"==typeof t)return this.__collision_tag(t);for(var i=0,_=0;_<t.length;++_)i|=this.__collision_tag(t[_]);return i},__collision_tag:function(t){return void 0===this.__collision_tags[t]&&this.__create_collision_tag(t),this.__collision_tags[t]},__get_grid_range:function(t){var i=t.get_aabb(),_=Math.floor(i.position.x/this.__params.grid_size),e=Math.floor(i.position.y/this.__params.grid_size),s=Math.floor((i.position.x+i.size.x)/this.__params.grid_size),o=Math.floor((i.position.y+i.size.y)/this.__params.grid_size);return{min_x:_,min_y:e,max_x:s,max_y:o}},add:function(i){if(i.__world)throw new t.IllegalActionError("Object to add is already in a collision world!");for(var _=this.__get_grid_range(i),e=_.min_x;e<=_.max_x;++e)for(var s=_.min_y;s<=_.max_y;++s){this.__grid[e]=this.__grid[e]||{},this.__grid[e][s]=this.__grid[e][s]||[];var o=this.__grid[e][s];o.push(i),i.__grid_chunks.push(o)}return i.__world=this,i.__grid_bounderies=_,i.__last_insert_aabb=i.get_aabb().clone(),this.__all_shapes[i.get_id()]=i,i},get_all_shapes:function(){var t=[];for(var i in this.__all_shapes)this.__all_shapes.hasOwnProperty(i)&&t.push(this.__all_shapes[i]);return t},remove:function(i){if(i.__world!==this)throw new t.IllegalActionError("Object to remove is not in this collision world!");for(var _=0;_<i.__grid_chunks.length;++_)for(var e=i.__grid_chunks[_],s=0;s<e.length;++s)if(e[s]===i){e.splice(s,1);break}delete this.__all_shapes[i.get_id()],i.__grid_chunks=[],i.__world=null,i.__grid_bounderies=null,i.__last_insert_aabb=null},__update_shape_grid:function(t){var i=t.get_aabb();(0===this.__params.grid_error||Math.abs(i.position.x-t.__last_insert_aabb.position.x)>this.__params.grid_error||Math.abs(i.position.y-t.__last_insert_aabb.position.y)>this.__params.grid_error||Math.abs(i.size.x-t.__last_insert_aabb.size.x)>this.__params.grid_error||Math.abs(i.size.y-t.__last_insert_aabb.size.y)>this.__params.grid_error)&&(this.remove(t),this.add(t))},pick_object:function(t,i){var _=[];return this.test_collision(t,i,_,1)?_[0]:null},test_collision:function(i,_,e,s){return _=this.__get_tags_value(_),i instanceof t.Vector?this.__test_collision_point(i,_,e,s):i.is_shape?this.__test_collision_shape(i,_,e,s):void 0},test_fov:function(i,_,e,s,o,n){o=this.__get_tags_value(o),n=n||[];var r=new t.Circle(i,_);this.__test_collision_shape(r,o,n);for(var l=n.length-1;l>=0;--l){var a=i.angle_from(n[l].__position);t.Math.angles_dis(e,a)>s&&n.splice(l,1)}return n.length>0},__test_collision_point:function(t,i,_,e){var s=this.__params.grid_size,o=Math.floor(t.x/s),n=Math.floor(t.y/s);if(void 0===this.__grid[o]||void 0===this.__grid[o][n])return!1;for(var r=this.__grid[o][n],l=0,o=0;o<r.length;++o){var a=r[o];if(a.collision_tags_match(i)&&this.__do_collision(a,t)){if(!_)return!0;if(l++,_.push(a),e&&l>=e)return!0}}return l>0},__test_collision_shape:function(t,i,_,e){var s;s=t.__world===this?t.__grid_bounderies:this.__get_grid_range(t);for(var o=0,n={},r=s.min_x;r<=s.max_x;++r)if(void 0!==this.__grid[r])for(var l=s.min_y;l<=s.max_y;++l){var a=this.__grid[r][l];if(void 0!==a)for(var h=0;h<a.length;++h){var c=a[h];if(c!==t&&!n[c.get_id()]&&(n[c.get_id()]=!0,c.collision_tags_match(i)&&this.__do_collision(c,t))){if(!_)return!0;if(o++,_.push(c),e&&o>=e)return!0}}}return o>0},__do_collision:function(t,i){return t.test_collide_with(i)},render:function(i,_,e,s){_=_||t.Vector.ZERO,void 0===e&&(e=!0),void 0===s&&(s=!0);var o=i.getContext("2d");o.setTransform(1,0,0,1,0,0);for(var n=this.__params.grid_size,r=Math.floor(_.x/n),l=Math.floor(_.y/n),a=r+Math.ceil(i.width/n),h=l+Math.ceil(i.height/n),c=[],p=r;a>=p;++p)for(var u=l;h>=u;++u){var f=void 0;if(this.__grid[p]&&(f=this.__grid[p][u]),e){var d=new t.Vector(p*n,u*n).sub_self(_);o.beginPath(),o.rect(d.x,d.y,n-1,n-1),o.lineWidth="1",void 0===f||0===f.length?o.strokeStyle="rgba(100, 100, 100, 0.255)":o.strokeStyle="rgba(255, 0, 0, 0.3)",o.stroke()}if(void 0!==f)for(var g=0;g<f.length;++g){var y=f[g];-1===c.indexOf(y)&&c.push(f[g])}}for(var p=0;p<c.length;++p)c[p].render(o,_),s&&c[p].render_aabb(o,_)}},t.IllegalActionError=function(t){this.name="Illegal Action",this.message=t||""},t.IllegalActionError.prototype=Error.prototype,t.TilemapWorld=function(t,i){var _=i;_=_||{},_.grid_size=t,this.__tiles={},this.__init_world(_)},t.TilemapWorld.prototype={set_tile:function(i,_,e){var s=this.get_tile(i);if(!_)return void(s&&(this.__set_tile_shape(i,null),this.remove(s),delete s));if(void 0===s){var o=this.__params.grid_size,n=i.multiply_scalar(o),r=new t.Vector(o,o);s=this.__add_tile_shape(new t.Rectangle(n,r),i),this.__set_tile_shape(i,s)}void 0!==e&&s.set_collision_tags(e)},__add_tile_shape:function(t,i){this.__grid[i.x]=this.__grid[i.x]||{},this.__grid[i.x][i.y]=this.__grid[i.x][i.y]||[];var _=this.__grid[i.x][i.y];return _.push(t),t.__grid_chunks=[_],t.__world=this,t.__grid_bounderies={min_x:i.x,min_y:i.y,max_x:i.x,max_y:i.y},this.__all_shapes[t.get_id()]=t,t},set_from_matrix:function(i){for(var _=new t.Vector(0,0),e=0;e<i.length;++e){_.x=0;for(var s=0;s<i[e].length;++s)this.set_tile(_,i[e][s]),_.x++;_.y++}},get_tile:function(t){return this.__tiles[t.x+"_"+t.y]},__set_tile_shape:function(t,i){null===i?delete this.__tiles[t.x+"_"+t.y]:this.__tiles[t.x+"_"+t.y]=i}},t.extend(t.World.prototype,t.TilemapWorld.prototype),t.Shape=function(){},t.Shape.prototype={__type:"shape",__collision_type:null,is_shape:!0,__data:null,__next_id:0,__collision_tags:[],__collision_tags_val:t.World.prototype._ALL_TAGS_VAL,__init__:function(){this.__position=new t.Vector,this.__grid_chunks=[],this.__world=null,this.__grid_bounderies=null,this.__last_insert_aabb=null,this.__id=t.Shape.prototype.__next_id++},get_id:function(){return this.__id},set_collision_tags:function(i){if(null===this.__world)throw new t.IllegalActionError("Can't set tags for a shape that is not inside a collision world!");return null===i?(this.__collision_tags=[],this.__collision_tags_val=t.World.prototype._ALL_TAGS_VAL):(this.__collision_tags_val=this.__world.__get_tags_value(i),!i instanceof Array&&(i=[i]),this.__collision_tags=i),this.__update_tags_hook&&this.__update_tags_hook(),this},__update_tags_hook:null,get_collision_tags:function(t){return this.__collision_tags},collision_tags_match:function(i){if(isNaN(i)){if(null===this.__world)throw new t.IllegalActionError("If you provide tags as string(s) the shape must be inside a collision world to convert them!");i=this.__world.__get_tags_value(i)}return 0!==(this.__collision_tags_val&i)},test_collide_with:function(i){return t.CollisionManager.test_collision(this,i)},repel:function(i,_,e,s,o){_=_||1,e=e||1,void 0===s&&(s=0),void 0===o&&(o=1);var n,r,l=this.get_repel_direction(i).multiply_scalar_self(_);o&&(n=l.multiply_scalar(o)),s&&(r=l.multiply_scalar(-1*s));for(var a=t.Vector.ZERO.clone(),h=!0;h&&e>0;)e--,n&&i.move(n),r&&this.move(r),a.add_self(l),h=this.test_collide_with(i);return a},get_repel_direction:function(i){var _,e=this.get_abs_center();return _=i instanceof t.Vector?i:i.get_abs_center(),_.sub(e).normalize_self()},__get_render_fill_color:function(t){return this.__override_fill_color?this.__override_fill_color:this.__collision_tags_to_color(this.__collision_tags_val,t)},__get_render_stroke_color:function(t){return this.__override_stroke_color?this.__override_stroke_color:this.__collision_tags_to_color(this.__collision_tags_val,t)},set_debug_render_colors:function(t,i){this.__override_fill_color=t,this.__override_stroke_color=i},__override_fill_color:null,__override_stroke_color:null,__collision_tags_to_color:function(t,i){var _=Math.round(255*Math.abs(Math.sin(t))),e=Math.round(255*Math.abs(Math.cos(t))),s=Math.round(_^e);return"rgba("+_+","+e+","+s+","+i+")"},set_data:function(t){return this.__data=t,this},get_data:function(){return this.__data},get_name:function(){return this.__type},render_aabb:function(t,i){var _=this.get_aabb();t.beginPath(),t.rect(_.position.x-i.x,_.position.y-i.y,_.size.x,_.size.y),t.lineWidth="1",t.strokeStyle="rgba(50, 175, 45, 0.5)",t.stroke()},set_position:function(t){return this.__position.x=t.x,this.__position.y=t.y,this.__update_position(),this},get_position:function(){return this.__position.clone()},move:function(t){return this.set_position(this.__position.add(t)),this},__update_position:function(){this.__update_position_hook&&this.__update_position_hook(),this.__aabb&&this.__update_aabb_pos(),this.__update_parent_world()},__update_aabb_pos:function(){this.__aabb.position=this.__position},get_abs_center:function(){var t=this.get_aabb();return t.position.add(t.size.multiply_scalar(.5))},reset_aabb:function(){this.__aabb=void 0},__update_parent_world:function(){this.__world&&this.__world.__update_shape_grid(this)},__update_position_hook:null,render:function(i,_){throw new t.NotImplementedError},build_aabb:function(){throw new t.NotImplementedError},get_aabb:function(){return this.__aabb=this.__aabb||this.build_aabb(),this.__aabb}},t.Circle=function(i,_){this.init(),this.__radius=_,this.__size=new t.Vector(_,_).multiply_scalar_self(2),this.set_position(i)},t.Circle.prototype={__type:"circle",__collision_type:"circle",render:function(t,i){var _=this.__position.sub(i);t.beginPath(),t.arc(_.x,_.y,this.__radius,0,2*Math.PI,!1),t.lineWidth="7",t.strokeStyle=this.__get_render_stroke_color(.75),t.stroke(),t.fillStyle=this.__get_render_fill_color(.35),t.fill()},get_radius:function(){return this.__radius},__update_aabb_pos:function(){this.__aabb.position=this.__position.sub_scalar(this.__radius)},build_aabb:function(){return new t.AABB(this.__position.sub_scalar(this.__radius),this.__size)},get_abs_center:function(){return this.__position.clone()}},t.extend(t.Shape.prototype,t.Circle.prototype),t.Rectangle=function(t,i){this.init(),this.__size=i,this.set_position(t)},t.Rectangle.prototype={__type:"rectangle",__collision_type:"rectangle",render:function(t,i){var _=this.__position.sub(i);t.beginPath(),t.rect(_.x,_.y,this.__size.x,this.__size.y),t.lineWidth="7",t.strokeStyle=this.__get_render_stroke_color(.75),t.stroke(),t.fillStyle=this.__get_render_fill_color(.35),t.fill()},get_size:function(){return this.__size.clone()},build_aabb:function(){return new t.AABB(this.__position,this.__size)},get_top_left:function(){return this.__top_left_c=this.__top_left_c||this.__position.clone(),this.__top_left_c},get_bottom_left:function(){return this.__bottom_left_c=this.__bottom_left_c||this.__position.add(new t.Vector(0,this.__size.y)),this.__bottom_left_c},get_top_right:function(){return this.__top_right_c=this.__top_right_c||this.__position.add(new t.Vector(this.__size.x,0)),this.__top_right_c},get_bottom_right:function(){return this.__bottom_right_c=this.__bottom_right_c||this.__position.add(new t.Vector(this.__size.x,this.__size.y)),this.__bottom_right_c},get_abs_center:function(){return this.__abs_center_c=this.__abs_center_c||this.__position.add(this.__size.divide_scalar(2)),this.__abs_center_c},__update_position_hook:function(){this.__top_left_c=void 0,this.__top_right_c=void 0,this.__bottom_left_c=void 0,this.__bottom_right_c=void 0,this.__abs_center_c=void 0}},t.extend(t.Shape.prototype,t.Rectangle.prototype),t.Line=function(t,i){this.init(),this.__dest=i,this.set_position(t)},t.Line.prototype={__type:"line",__collision_type:"line",render:function(t,i){t.beginPath(),t.moveTo(this.__position.x,this.__position.y);var _=this.__position.add(this.__dest);t.lineTo(_.x,_.y),t.lineWidth="7",t.strokeStyle=this.__get_render_stroke_color(.75),t.stroke()},build_aabb:function(){var i=new t.Vector(0,0);i.x=this.__dest.x>0?this.__position.x:this.__position.x+this.__dest.x,i.y=this.__dest.y>0?this.__position.y:this.__position.y+this.__dest.y;var _=this.__dest.apply(Math.abs);return new t.AABB(i,_)},get_p1:function(){return this.__p1_c=this.__p1_c||this.__position.clone(),this.__p1_c},get_p2:function(){return this.__p2_c=this.__p2_c||this.__position.add(this.__dest),this.__p2_c},__update_position_hook:function(){this.__p1_c=void 0,this.__p2_c=void 0}},t.extend(t.Shape.prototype,t.Line.prototype),t.LineStrip=function(i,_,e){if(this.init(),this.__points=_,_.length<=1)throw new t.IllegalActionError("Not enough vectors for LineStrip (got to have at least two vectors)");e&&this.__points.push(this.__points[0]),this.set_position(i)},t.LineStrip.prototype={__type:"line-strip",__collision_type:"line-strip",render:function(t,i){var _=void 0;t.beginPath();for(var e=0;e<this.__points.length-1;++e){var s=this.__position.add(this.__points[e]);_=this.__position.add(this.__points[e+1]),t.moveTo(s.x,s.y),t.lineTo(_.x,_.y)}t.moveTo(_.x,_.y),_=this.__position.add(this.__points[this.__points.length-1]),t.lineTo(_.x,_.y),t.lineWidth="7",t.strokeStyle=this.__get_render_stroke_color(.75),t.stroke()},get_abs_lines:function(){if(this.__abs_lines_c)return this.__abs_lines_c;for(var t=this.get_abs_points(),i=[],_=0;_<t.length-1;_++)i.push([t[_],t[_+1]]);return this.__abs_lines_c=i,i},get_abs_points:function(){if(this.__abs_points_c)return this.__abs_points_c;for(var t=[],i=0;i<this.__points.length;i++)t.push(this.__points[i].add(this.__position));return this.__abs_points_c=t,t},__update_position_hook:function(){this.__abs_points_c=void 0,this.__abs_lines_c=void 0},__update_aabb_pos:function(){this.__aabb.position.set(this.__aabb_offset_c.add(this.__position))},build_aabb:function(){for(var i=new t.AABB(t.Vector.ZERO,t.Vector.ZERO),_=0;_<this.__points.length;++_)i.add_vector(this.__points[_]);return this.__aabb_offset_c=i.position.clone(),i.position.add_self(this.__position),i}},t.extend(t.Shape.prototype,t.LineStrip.prototype),t.CompositeShape=function(t,i){this.init(),this.__init_comp_shape(t,i)},t.CompositeShape.prototype={__type:"composite-shape",__collision_type:"composite-shape",__init_comp_shape:function(i,_){if(this.__shapes=[],i=i||t.Vector.ZERO,this.set_position(i),_)for(var e=0;e<_.length;++e)this.add(_[e])},render:function(t,i){for(var _=0;_<this.__shapes.length;++_)this.__shapes[_].shape.render(t,i)},repel:function(i,_,e,s,o){for(var n=t.Vector.ZERO.clone(),r=0;r<this.__shapes.length;++r){var l=this.__shapes[r].shape;l.test_collide_with(i)&&n.add_self(l.repel(i,_,e,0,o))}return 0!==(s||0)&&this.move(n.multiply_scalar(-1*s)),n},set_debug_render_colors:function(t,i){this.__override_fill_color=t,this.__override_stroke_color=i;for(var _=0;_<this.__shapes.length;++_)this.__shapes[_].shape.set_debug_render_colors(t,i)},get_shapes:function(){if(this.__shapes_list_c)return this.__shapes_list_c;for(var t=[],i=0;i<this.__shapes.length;++i)t.push(this.__shapes[i].shape);return this.__shapes_list_c=t,t},build_aabb:function(){if(0===this.__shapes.length)return this.__aabb_pos_offset_c=t.Vector.ZERO,new t.AABB(t.Vector.ZERO,t.Vector.ZERO);for(var i=null,_=0;_<this.__shapes.length;++_){var e=this.__shapes[_].shape.get_aabb();i?i.expand(e):i=e}return this.__aabb_pos_offset_c=i.position.sub(this.__position),i},__update_aabb_pos:function(){this.__aabb.position=this.__position.add(this.__aabb_pos_offset_c)},add:function(i){if(i.__world)throw new t.IllegalActionError("Can't add shape with collision world to a composite shape!");var _=i.__position;return this.__shapes_list_c=void 0,this.__shapes.push({shape:i,offset:_.clone()}),i.set_position(this.__position.add(_)),this.reset_aabb(),this.__update_parent_world(),i.__collision_tags_val=this.__collision_tags_val,i.__collision_tags=this.__collision_tags,i.__override_fill_color=this.__override_fill_color,i.__override_stroke_color=this.__override_stroke_color,i},__update_tags_hook:function(){for(var t=0;t<this.__shapes;++t){var i=this.__shapes[t].shape;i.__collision_tags_val=this.__collision_tags_val,i.__collision_tags=this.__collision_tags}},remove:function(i){this.__shapes_list_c=void 0;for(var _=0;_<this.__shapes.length;++_)if(this.__shapes[_].shape===i)return this.__shapes.splice(_,1),void this.__update_parent_world();throw new t.IllegalActionError("Shape to remove is not in composite shape!")},__update_position_hook:function(){for(var t=0;t<this.__shapes.length;++t)this.__shapes[t].shape.set_position(this.__position.add(this.__shapes[t].offset))}},t.extend(t.Shape.prototype,t.CompositeShape.prototype),t.Capsule=function(i,_,e){this.init(),void 0===e&&(e=!0),objects=[],e?(_=_.clone(),_.y-=_.x,objects.push(new t.Rectangle(new t.Vector(.5*-_.x,.5*-_.y),_)),objects.push(new t.Circle(new t.Vector(0,.5*-_.y),.5*_.x)),objects.push(new t.Circle(new t.Vector(0,.5*_.y),.5*_.x))):(_=_.clone(),_.y-=_.x,objects.push(new t.Rectangle(new t.Vector(.5*-_.y,.5*-_.x),_.flip())),objects.push(new t.Circle(new t.Vector(.5*-_.y,0),.5*_.x)),objects.push(new t.Circle(new t.Vector(.5*_.y,0),.5*_.x))),this.__init_comp_shape(i,objects)},t.Capsule.prototype={__type:"capsule"},t.extend(t.CompositeShape.prototype,t.Capsule.prototype),t.CollisionManager={test_collision:function(i,_){if(i instanceof t.Vector&&_ instanceof t.Vector)return this._test_collision_vector_vector(i,_);if("composite-shape"==i.__collision_type)return this._test_collision_composite_shape(i,_);if("composite-shape"==_.__collision_type)return this._test_collision_composite_shape(_,i);if(i instanceof t.Vector&&"circle"==_.__collision_type)return this._test_collision_circle_vector(_,i);if("circle"==i.__collision_type&&_ instanceof t.Vector)return this._test_collision_circle_vector(i,_);if("circle"==i.__collision_type&&"circle"==_.__collision_type)return this._test_collision_circle_circle(_,i);if("circle"==i.__collision_type&&"rectangle"==_.__collision_type)return this._test_collision_circle_rect(i,_);if("rectangle"==i.__collision_type&&"circle"==_.__collision_type)return this._test_collision_circle_rect(_,i);if("circle"==i.__collision_type&&"line"==_.__collision_type)return this._test_collision_circle_line(i,_);if("line"==i.__collision_type&&"circle"==_.__collision_type)return this._test_collision_circle_line(_,i);if("line-strip"==i.__collision_type&&"line"==_.__collision_type)return this._test_collision_linestrip_line(i,_);if("line"==i.__collision_type&&"line-strip"==_.__collision_type)return this._test_collision_linestrip_line(_,i);if("circle"==i.__collision_type&&"line-strip"==_.__collision_type)return this._test_collision_circle_linestrip(i,_);if("line-strip"==i.__collision_type&&"circle"==_.__collision_type)return this._test_collision_circle_linestrip(_,i);if(i instanceof t.Vector&&"rectangle"==_.__collision_type)return this._test_collision_rect_vector(_,i);if("rectangle"==i.__collision_type&&_ instanceof t.Vector)return this._test_collision_rect_vector(i,_);if("rectangle"==i.__collision_type&&"rectangle"==_.__collision_type)return this._test_collision_rect_rect(_,i);if("line-strip"==i.__collision_type&&"line-strip"==_.__collision_type)return this._test_collision_linestrip_linestrip(i,_);if("line"==i.__collision_type&&"rectangle"==_.__collision_type)return this._test_collision_rect_line(_,i);if("rectangle"==i.__collision_type&&"line"==_.__collision_type)return this._test_collision_rect_line(i,_);if("line-strip"==i.__collision_type&&"rectangle"==_.__collision_type)return this._test_collision_rect_linestrip(_,i);if("rectangle"==i.__collision_type&&"line-strip"==_.__collision_type)return this._test_collision_rect_linestrip(i,_);if("line"==i.__collision_type&&"line"==_.__collision_type)return this._test_collision_line_line(i,_);if("line"==i.__collision_type&&_ instanceof t.Vector)return this._test_collision_vector_line(_,i);if(i instanceof t.Vector&&"line"==_.__collision_type)return this._test_collision_vector_line(i,_);if("line-strip"==i.__collision_type&&_ instanceof t.Vector)return this._test_collision_vector_linestrip(_,i);if(i instanceof t.Vector&&"line-strip"==_.__collision_type)return this._test_collision_vector_linestrip(i,_);throw new t.UnsupportedShapes(i,_)},_test_collision_vector_vector:function(t,i){return t.x===i.x&&t.y===i.y},_test_collision_circle_vector:function(i,_){return t.Math.distance(i.__position,_)<=i.__radius},_test_collision_circle_circle:function(i,_){return t.Math.distance(i.__position,_.__position)<=i.__radius+_.__radius},_test_collision_rect_vector:function(t,i){return i.x>=t.__position.x&&i.y>=t.__position.y&&i.x<=t.__position.x+t.__size.x&&i.y<=t.__position.y+t.__size.y},_test_collision_vector_line:function(i,_){return t.Math.is_on_line(i,_.get_p1(),_.get_p2())},_test_collision_vector_linestrip:function(i,_){for(var e=_.get_abs_lines(),s=0;s<e.length;++s)if(t.Math.is_on_line(i,e[s][0],e[s][1]))return!0;return!1},_test_collision_circle_line:function(i,_){return t.Math.distance_to_line(i.__position,_.get_p1(),_.get_p2())<=i.__radius},_test_collision_circle_linestrip:function(i,_){for(var e=_.get_abs_lines(),s=0;s<e.length;++s)if(t.Math.distance_to_line(i.__position,e[s][0],e[s][1])<=i.__radius)return!0;return!1},_test_collision_linestrip_line:function(i,_){for(var e=i.get_abs_lines(),s=_.get_p1(),o=_.get_p2(),n=0;n<e.length;++n)if(t.Math.line_intersects(s,o,e[n][0],e[n][1]))return!0;return!1},_test_collision_line_line:function(i,_){return t.Math.line_intersects(i.get_p1(),i.get_p2(),_.get_p1(),_.get_p2())},_test_collision_rect_line:function(i,_){var e=_.get_p1(),s=_.get_p2();if(t.CollisionManager._test_collision_rect_vector(i,e)||t.CollisionManager._test_collision_rect_vector(i,s))return!0;var o=i.get_top_left(),n=i.get_bottom_left();if(t.Math.line_intersects(e,s,o,n))return!0;var r=i.get_top_right(),l=i.get_bottom_right();return t.Math.line_intersects(e,s,r,l)?!0:t.Math.line_intersects(e,s,o,r)?!0:t.Math.line_intersects(e,s,n,l)?!0:!1},_test_collision_rect_linestrip:function(i,_){for(var e=_.get_abs_points(),s=0;s<e.length;++s)if(this._test_collision_rect_vector(i,e[s]))return!0;for(var o=i.get_top_left(),n=i.get_bottom_left(),r=i.get_top_right(),l=i.get_bottom_right(),a=_.get_abs_lines(),s=0;s<a.length;++s){var h=a[s][0],c=a[s][1];if(t.Math.line_intersects(h,c,o,n))return!0;if(t.Math.line_intersects(h,c,r,l))return!0;if(t.Math.line_intersects(h,c,o,r))return!0;if(t.Math.line_intersects(h,c,n,l))return!0}return!1},_test_collision_linestrip_linestrip:function(i,_){for(var e=i.get_abs_lines(),s=_.get_abs_lines(),o=0;o<e.length;++o)for(var n=0;n<s.length;++n)if(t.Math.line_intersects(e[o][0],e[o][1],s[n][0],s[n][1]))return!0;return!1},_test_collision_composite_shape:function(i,_){var e=i.get_shapes();if("composite-shape"==_.__collision_type){for(var s=_.get_shapes(),o=0;o<e.length;++o)for(var n=0;n<s.length;++n)if(t.CollisionManager.test_collision(e[o],s[n]))return!0}else for(var o=0;o<e.length;++o)if(t.CollisionManager.test_collision(e[o],_))return!0;return!1},_test_collision_circle_rect:function(i,_){var e=i.__position,s=t.CollisionManager._test_collision_rect_vector(_,e);if(s)return!0;var o=_.get_abs_center(),s=t.CollisionManager._test_collision_circle_vector(i,o);if(s)return!0;var n=[];o.x>e.x?n.push([_.get_top_left(),_.get_bottom_left()]):n.push([_.get_top_right(),_.get_bottom_right()]),o.y>e.y?n.push([_.get_top_left(),_.get_top_right()]):n.push([_.get_bottom_left(),_.get_bottom_right()]);for(var r=0;r<n.length;++r){var l=t.Math.distance_to_line(e,n[r][0],n[r][1]);if(l<=i.__radius)return!0}return!1},_test_collision_rect_rect:function(t,i){var _={left:t.__position.x,right:t.__position.x+t.__size.x,top:t.__position.y,bottom:t.__position.y+t.__size.y},e={left:i.__position.x,right:i.__position.x+i.__size.x,top:i.__position.y,bottom:i.__position.y+i.__size.y};return!(e.left>_.right||e.right<_.left||e.top>_.bottom||e.bottom<_.top)}},t.UnsupportedShapes=function(t,i){this.name="Unsupported Shapes",this.message="Unsupported shapes collision test! '"+t.get_name()+"' <-> '"+i.get_name()+"'."},t.UnsupportedShapes.prototype=Error.prototype,t}();"undefined"!=typeof exports&&(exports.sscd=SSCD);